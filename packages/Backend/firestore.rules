service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read: if request.auth.token != null;
    }
    match /journals/{journal} {
      // allow authors to create the initial primary firestore document
      allow create: if request.auth.token.author == true;
      // allow authors to move the document to editing and editors to move
      // the document to published
      allow update: if (request.auth.token.author == true && resource.data.phase == 'create') || (request.auth.token.editor == true && resource.data.phase == 'edit');
    }
    match /tasks/{task} {
      allow create: if (request.auth.token.author == true && request.resource.data.type == 'submit')
    }
  }
}

